# =============================================================================
# METRICS SERVER VALUES
# =============================================================================
# Aula 07 - PosTech DevOps - Observabilidade no Kubernetes
# Configuração para metrics-server (Métricas de recursos do cluster)
# =============================================================================

# =============================================================================
# IMAGE CONFIGURATION
# =============================================================================
image:
  repository: registry.k8s.io/metrics-server/metrics-server
  tag: v0.6.4
  pullPolicy: IfNotPresent

# =============================================================================
# DEPLOYMENT CONFIGURATION
# =============================================================================
replicas: 2

# Recursos computacionais
resources:
  requests:
    cpu: 100m
    memory: 200Mi
  limits:
    cpu: 200m
    memory: 400Mi

# =============================================================================
# METRICS SERVER CONFIGURATION
# =============================================================================
args:
  - --cert-dir=/tmp
  - --secure-port=4443
  - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname
  - --kubelet-use-node-status-port
  - --metric-resolution=15s
  # Para ambientes de desenvolvimento/lab (não usar em produção)
  - --kubelet-insecure-tls

# =============================================================================
# SERVICE CONFIGURATION
# =============================================================================
service:
  type: ClusterIP
  port: 443
  targetPort: 4443
  annotations: {}
  labels: {}

# =============================================================================
# SERVICE MONITOR CONFIGURATION
# =============================================================================
serviceMonitor:
  enabled: true
  additionalLabels:
    app.kubernetes.io/part-of: observability-stack
  interval: 30s
  scrapeTimeout: 10s
  namespace: monitoring
  namespaceSelector: {}

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL

containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL

# =============================================================================
# RBAC CONFIGURATION
# =============================================================================
rbac:
  create: true
  pspEnabled: false

serviceAccount:
  create: true
  name: ""
  annotations: {}

# =============================================================================
# POD CONFIGURATION
# =============================================================================
podLabels:
  app.kubernetes.io/part-of: observability-stack
  course: postech-devops
  class: aula-07

podAnnotations: {}

# =============================================================================
# SCHEDULING CONFIGURATION
# =============================================================================
nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - metrics-server
        topologyKey: kubernetes.io/hostname

# =============================================================================
# DISRUPTION BUDGET
# =============================================================================
podDisruptionBudget:
  enabled: false
  minAvailable: 1
  maxUnavailable: ""

# =============================================================================
# ADDITIONAL CONFIGURATION
# =============================================================================
priorityClassName: ""

runtimeClassName: ""

hostNetwork:
  enabled: false

dnsPolicy: ClusterFirst

# Volume mounts adicionais
extraVolumeMounts: []

# Volumes adicionais
extraVolumes: []

# Configurações de liveness e readiness probes
livenessProbe:
  httpGet:
    path: /livez
    port: https
    scheme: HTTPS
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 1
  failureThreshold: 3
  successThreshold: 1

readinessProbe:
  httpGet:
    path: /readyz
    port: https
    scheme: HTTPS
  initialDelaySeconds: 20
  periodSeconds: 10
  timeoutSeconds: 1
  failureThreshold: 3
  successThreshold: 1

# =============================================================================
# NETWORKING CONFIGURATION
# =============================================================================
hostAliases: []

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================
metrics:
  enabled: true

# =============================================================================
# COMMON LABELS
# =============================================================================
commonLabels:
  app.kubernetes.io/part-of: observability-stack
  course: postech-devops
  class: aula-07
# =============================================================================
# KUBE-PROMETHEUS-STACK VALUES
# =============================================================================
# Aula 07 - PosTech DevOps - Observabilidade no Kubernetes
# Configuração para kube-prometheus-stack (Prometheus + Grafana + AlertManager)
# =============================================================================

# Configurações globais
fullnameOverride: ""
nameOverride: ""

# =============================================================================
# PROMETHEUS CONFIGURATION
# =============================================================================
prometheus:
  enabled: true
  
  prometheusSpec:
    # External URL e route prefix
    externalUrl: https://prometheus.demo.lynxnetwork.com.br
    routePrefix: /
    
    # Recursos computacionais
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 2Gi
        cpu: 1000m
    
    # Storage persistente
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: gp2
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 20Gi
    
    # Retenção de dados
    retention: 7d
    retentionSize: 10GB
    
    # Configurações de scraping
    scrapeInterval: 30s
    evaluationInterval: 30s
    
    # Service discovery
    serviceDiscoveryNamespaceSelector: {}
    serviceMonitorNamespaceSelector: {}
    podMonitorNamespaceSelector: {}
    ruleNamespaceSelector: {}
    
    # Configurações de segurança
    securityContext:
      runAsNonRoot: true
      runAsUser: 65534
      fsGroup: 65534
    
    # Configurações de rede
    portName: web
    
  # Service configuration
  service:
    type: ClusterIP
    port: 9090
    targetPort: 9090
    
  # Ingress (desabilitado - acesso via port-forward)
  ingress:
    enabled: false

# =============================================================================
# GRAFANA CONFIGURATION
# =============================================================================
grafana:
  enabled: true
  
  # Credenciais de admin
  adminPassword: admin123
  
  # Recursos computacionais
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 200m
  
  # Storage persistente
  persistence:
    enabled: true
    storageClassName: gp2
    size: 10Gi
    accessModes:
      - ReadWriteOnce
  
  # Service configuration
  service:
    type: ClusterIP
    port: 80
    targetPort: 3000
  
  # Configurações do Grafana
  grafana.ini:
    server:
      root_url: "https://grafana.demo.lynxnetwork.com.br/"
      serve_from_sub_path: false
    security:
      allow_embedding: true
    auth.anonymous:
      enabled: true
      org_role: Viewer

  # Configurações de data sources (automático via sidecar)
  sidecar:
    datasources:
      enabled: true
      defaultDatasourceEnabled: true
      # Adicionar Loki como datasource
      datasources:
        datasources.yaml:
          apiVersion: 1
          datasources:
          - name: Loki
            type: loki
            access: proxy
            url: http://loki.monitoring.svc.cluster.local:3100
            isDefault: false
            editable: true
    dashboards:
      enabled: true
      searchNamespace: ALL
  
  # Configurações de segurança
  securityContext:
    runAsNonRoot: true
    runAsUser: 472
    fsGroup: 472
  
  # Plugins adicionais
  plugins:
    - grafana-piechart-panel
    - grafana-worldmap-panel

  # Ingress (desabilitado - acesso via port-forward)
  ingress:
    enabled: false

# =============================================================================
# ALERTMANAGER CONFIGURATION
# =============================================================================
alertmanager:
  enabled: false

# =============================================================================
# NODE EXPORTER CONFIGURATION
# =============================================================================
nodeExporter:
  enabled: true
  
  # Recursos computacionais
  resources:
    requests:
      memory: 64Mi
      cpu: 50m
    limits:
      memory: 128Mi
      cpu: 100m

# =============================================================================
# KUBE STATE METRICS CONFIGURATION
# =============================================================================
kubeStateMetrics:
  enabled: true
  
  # Recursos computacionais
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
      cpu: 100m

# =============================================================================
# PROMETHEUS OPERATOR CONFIGURATION
# =============================================================================
prometheusOperator:
  enabled: true
  
  # Recursos computacionais
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
      cpu: 100m
  
  # Configurações de admissão
  admissionWebhooks:
    enabled: true
    patch:
      enabled: true

# =============================================================================
# ADDITIONAL CONFIGURATIONS
# =============================================================================

# Configurações de RBAC
rbac:
  create: true

# Service accounts
serviceAccount:
  create: true

# Configurações de namespace
namespaceOverride: "monitoring"

# Labels comuns
commonLabels:
  app.kubernetes.io/part-of: observability-stack
  course: postech-devops
  class: aula-07
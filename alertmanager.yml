# =============================================================================
# ALERTMANAGER CONFIGURATION
# =============================================================================
# Configuração funcional do Alertmanager para gerenciamento e roteamento de alertas
# Aula 02 - PosTech DevOps e Arquitetura Cloud - Monitoramento OpenSource
# =============================================================================

# -----------------------------------------------------------------------------
# CONFIGURAÇÕES GLOBAIS
# -----------------------------------------------------------------------------
global:
  # Configuração SMTP para envio de emails (ajustar conforme seu provedor)
  smtp_smarthost: 'localhost:587'              # Servidor SMTP
  smtp_from: 'alertmanager@example.com'        # Email remetente

# -----------------------------------------------------------------------------
# ROTEAMENTO DE ALERTAS
# -----------------------------------------------------------------------------
route:
  group_by: ['alertname']           # Agrupa alertas pelo nome
  group_wait: 10s                   # Tempo de espera antes de enviar o primeiro alerta do grupo
  group_interval: 10s               # Tempo entre envios de alertas do mesmo grupo
  repeat_interval: 1h               # Intervalo para reenvio de alertas não resolvidos
  receiver: 'web.hook'              # Receptor padrão para todos os alertas

# -----------------------------------------------------------------------------
# RECEPTORES DE ALERTAS
# -----------------------------------------------------------------------------
receivers:
- name: 'web.hook'
  webhook_configs:
  - url: 'http://httpbin.org/post'  # URL de teste para desenvolvimento
    send_resolved: true             # Envia notificação quando alerta é resolvido

# -----------------------------------------------------------------------------
# REGRAS DE INIBIÇÃO
# -----------------------------------------------------------------------------
# Evita spam de alertas relacionados (ex: alerta crítico inibe warnings)
inhibit_rules:
- source_match:
    severity: 'critical'            # Se há um alerta crítico...
  target_match:
    severity: 'warning'             # ...inibe alertas de warning...
  equal: ['alertname', 'instance'] # ...para a mesma instância e alerta

# =============================================================================
# INSTRUÇÕES DE CONFIGURAÇÃO:
# =============================================================================
# 1. Para usar email real, configure:
#    - smtp_smarthost com seu servidor SMTP
#    - smtp_from com email válido
#    - Adicione smtp_auth_username e smtp_auth_password se necessário
#
# 2. Para usar webhook personalizado, ajuste a URL em receivers
#
# 3. Para testar alertas:
#    - Acesse http://IP_PROMETHEUS:9093
#    - Use a interface para criar silenciamentos
#
# 4. Para recarregar configuração:
#    docker-compose restart alertmanager
# =============================================================================
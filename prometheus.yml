# =============================================================================
# PROMETHEUS CONFIGURATION - AULA 04
# =============================================================================
# Configuração simplificada do Prometheus para correlação com logs do Loki
# Aula 04 - PosTech DevOps e Arquitetura Cloud - Monitoramento OpenSource
# Foco: Métricas básicas para correlação com logs centralizados
# =============================================================================

# -----------------------------------------------------------------------------
# CONFIGURAÇÕES GLOBAIS
# -----------------------------------------------------------------------------
global:
  scrape_interval: 15s      # Intervalo padrão para coleta de métricas (15 segundos)
  evaluation_interval: 15s  # Intervalo para avaliação de regras (não usado nesta aula)

# -----------------------------------------------------------------------------
# CONFIGURAÇÃO DE COLETA DE MÉTRICAS (SCRAPE CONFIGS)
# -----------------------------------------------------------------------------
scrape_configs:
  
  # ---------------------------------------------------------------------------
  # JOB 1: PROMETHEUS (Auto-monitoramento)
  # ---------------------------------------------------------------------------
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']    # O próprio Prometheus se monitora
    # Métricas disponíveis: prometheus_*, go_*, process_*
    # Útil para correlacionar com logs do próprio Prometheus
  
  # ---------------------------------------------------------------------------
  # JOB 2: LOKI (Métricas do servidor de logs)
  # ---------------------------------------------------------------------------
  - job_name: 'loki'
    static_configs:
      - targets: ['loki:3100']         # Métricas do Loki
    # Métricas disponíveis: loki_*, promtail_*
    # Útil para monitorar performance do sistema de logs
  
  # ---------------------------------------------------------------------------
  # JOB 3: PROMTAIL LOCAL (Métricas do agente de coleta)
  # ---------------------------------------------------------------------------
  - job_name: 'promtail-local'
    static_configs:
      - targets: ['promtail:9080']     # Promtail da própria instância
    # Métricas disponíveis: promtail_*
    # Útil para monitorar coleta de logs local

# =============================================================================
# INTEGRAÇÃO COM GRAFANA - AULA 04:
# =============================================================================
# 1. Este Prometheus será configurado como Data Source no Grafana
# 2. URL do Data Source: http://prometheus:9090
# 3. Foco principal: correlacionar métricas básicas com logs do Loki
#
# 4. Métricas principais para correlação:
#    - prometheus_tsdb_samples_appended_total: Volume de métricas
#    - loki_ingester_streams: Número de streams de logs
#    - promtail_sent_entries_total: Logs enviados pelo Promtail
#    - up: Status dos serviços (correlacionar com logs de erro)
#
# 5. Dashboards recomendados:
#    - Loki Stack Monitoring (ID: 14055)
#    - Prometheus Stats (ID: 2)
# =============================================================================
#
# CORRELAÇÃO LOGS + MÉTRICAS:
# =============================================================================
# Exemplos de correlação entre Prometheus e Loki:
#
# 1. Volume de logs vs métricas:
#    - Prometheus: rate(promtail_sent_entries_total[5m])
#    - Loki: rate({job="test-app"}[5m])
#
# 2. Erros em logs vs status de serviços:
#    - Prometheus: up{job="loki"}
#    - Loki: {job="test-app",level="error"}
#
# 3. Performance do sistema de logs:
#    - Prometheus: loki_ingester_chunks_created_total
#    - Loki: {job="loki"} |= "error"
# =============================================================================
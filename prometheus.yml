# =============================================================================
# PROMETHEUS CONFIGURATION
# =============================================================================
# Configuração principal do Prometheus para coleta de métricas
# Aula 02 - PosTech DevOps e Arquitetura Cloud - Monitoramento OpenSource
# =============================================================================

# -----------------------------------------------------------------------------
# CONFIGURAÇÕES GLOBAIS
# -----------------------------------------------------------------------------
global:
  scrape_interval: 15s      # Intervalo padrão para coleta de métricas (15 segundos)
  evaluation_interval: 15s  # Intervalo para avaliação de regras de alerta (15 segundos)

# -----------------------------------------------------------------------------
# ARQUIVOS DE REGRAS DE ALERTA
# -----------------------------------------------------------------------------
rule_files:
  - "alert_rules.yml"       # Arquivo contendo as regras de alerta personalizadas

# -----------------------------------------------------------------------------
# CONFIGURAÇÃO DO ALERTMANAGER
# -----------------------------------------------------------------------------
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093   # Endereço do Alertmanager (nome do container Docker)

# -----------------------------------------------------------------------------
# CONFIGURAÇÃO DE COLETA DE MÉTRICAS (SCRAPE CONFIGS)
# -----------------------------------------------------------------------------
scrape_configs:
  
  # ---------------------------------------------------------------------------
  # JOB 1: PROMETHEUS (Auto-monitoramento)
  # ---------------------------------------------------------------------------
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']    # O próprio Prometheus se monitora
  
  # ---------------------------------------------------------------------------
  # JOB 2: NODE EXPORTER (Métricas do sistema operacional)
  # ---------------------------------------------------------------------------
  # IMPORTANTE: Substitua IP_INSTANCIA_X pelos IPs privados reais das instâncias
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['IP_INSTANCIA_1:9100', 'IP_INSTANCIA_2:9100']
    # Métricas coletadas: CPU, memória, disco, rede, filesystem, etc.
    # Porta padrão: 9100
  
  # ---------------------------------------------------------------------------
  # JOB 3: CADVISOR (Métricas de containers Docker)
  # ---------------------------------------------------------------------------
  # IMPORTANTE: Substitua IP_INSTANCIA_X pelos IPs privados reais das instâncias
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['IP_INSTANCIA_1:8080', 'IP_INSTANCIA_2:8080']
    # Métricas coletadas: CPU/memória de containers, I/O, rede de containers
    # Porta padrão: 8080

# =============================================================================
# INSTRUÇÕES DE CONFIGURAÇÃO:
# =============================================================================
# 1. Substitua IP_INSTANCIA_1 e IP_INSTANCIA_2 pelos IPs privados reais
# 2. Para recarregar a configuração sem reiniciar:
#    curl -X POST http://localhost:9090/-/reload
# 3. Para verificar a configuração:
#    docker-compose exec prometheus promtool check config /etc/prometheus/prometheus.yml
# 4. Para ver targets ativos: http://IP_PROMETHEUS:9090/targets
# =============================================================================